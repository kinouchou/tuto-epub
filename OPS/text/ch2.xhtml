<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:epub="http://www.idpf.org/2007/ops"
  lang="fr" xml:lang="fr">
  <head>
    <title>Les bases d'un epub</title>
    <link href="../styles/stylesheet.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <h1 epub:type="bodymatter chapter">2 <span class="titre">Les bases d'un epub.</span></h1>
    <div id="TOC" epub:type="bodymatter toc">
      <ul>
        <li><a href="#ch2-01">Les différents fichiers obligatoires à un EPUB</a></li>
        <li><a href="#ch2-02">Créer le fichier final</a></li>
        <li><a href="#ch2-03">Vérifier l’EPUB</a></li>
      </ul>
    </div>
    <p>Un EPUB est un ensemble de fichiers (la plupart en <abbr>HTML</abbr>) compressés et ayant une extension .epub. Il est plus simple de faire un dossier par EPUB, de mettre dans ce dossier les fichiers et dossiers obligatoires. S’il y a besoin de fichiers intéressants pour le projets mais n’entrant pas dans l’EPUB final il vaut mieux les mettre dans un dossier à la racine de l’EPUB et de bien faire attention lors de la compression du dossier final pour ne pas inclure ce dossier annexe.</p>

    <h2 id="ch2-01" epub:type="bodymatter subchapter">Les différents fichiers obligatoires à un EPUB</h2>

    <h3>fichier mimetype</h3>
    <p>Il contient une seule ligne :
    <code>application/epub+zip</code></p>
    <p>Il doit toujours être à la racine du dossier.</p>

    <h3>dossier META-INF : les méta-données</h3>
    <h4>container.xml</h4>
    <a href="http://www.idpf.org/epub/30/spec/epub30-ocf.html#sec-container-metainf-container.xml">spec</a>
<pre>&lt;?xml version="1.0"?&gt;
&lt;container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container"&gt;
  &lt;rootfiles&gt;
    &lt;rootfile full-path="OPS/content.opf" media-type="application/oebps-package+xml"/&gt;
  &lt;/rootfiles&gt;
&lt;/container&gt;</pre>
    <p>Bien faire attention en mettant le chemin complet de <code>content.opf</code></p>

    <h3>dossier OPS : le contenu</h3>
    <h4>fichier content.opf</h4>
    <p><a href="http://idpf.org/epub/30/spec/epub30-publications.html#sec-package-elem">Spécifications de l’<abbr>idpf</abbr></a></p>
    <h5>l’entête</h5>
    <pre>&lt;?xml version="1.0" encoding="utf-8" standalone="no"?&gt;</pre>
    <p><code>standalone="no"</code> signifie que le fichier n'est pas autonome, c'est pas nécessaire de le noter car c'est sa valeur par défaut.</p>
    <h5>package</h5>
    <pre>&lt;package xmlns="http://www.idpf.org/2007/opf"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:dcterms="http://purl.org/dc/terms/"
    version="3.0" xml:lang="en"
    unique-identifier="pub-identifier"&gt;</pre>
    <p>Attention c'est ici qu'on dit la version de l'EPUB, bien indiquer la langue aussi. Pour la partie sur l'<a href="http://idpf.org/epub/30/spec/epub30-publications.html#sec-opf-metadata-identifiers-pid">unique-identifier</a>. On peut créer le numéro unique sur le site <a href="http://www.famkruithof.net/uuid/uuidgen">famkruithof.net</a>. Les <code>xmlns="…"</code> sont très importants, ils permettent de dire quel « dictionnaire » de termes on utilise. C’est utile pour indiquer les différentes sections de l’EPUB.</p>
    <h5>metadata</h5>
<pre>&lt;metadata&gt;
  &lt;dc:identifier id="pub-identifier"&gt;urn:isbn:numéro_isbn&lt;/dc:identifier&gt;
  &lt;dc:title id="pub-title"&gt;titre&lt;/dc:title&gt;
  &lt;dc:language id="pub-language"&gt;langue&lt;/dc:language&gt;
  &lt;dc:date&gt;date&lt;/dc:date&gt;
  &lt;meta property="dcterms:modified"&gt;… &lt;/meta&gt;
  &lt;dc:creator id="pub-creator12"&gt;auteur&lt;/dc:creator&gt;
  &lt;dc:contributor&gt;contributeur&lt;/dc:contributor&gt;
  &lt;dc:publisher&gt;éditeur&lt;/dc:publisher&gt;
  &lt;dc:rights&gt;la licence&lt;/dc:rights&gt;
&lt;/metadata&gt;</pre>
    <p>Il peut y avoir moins de <code>metadata</code> ou plus, les specs sont assez claires (pour une fois). Pour le <code>modified</code> c’est la date et l’heure sous la forme <code>yyyy-mm-jjThh:mm:ssZ</code></p>
    <h4>fichier toc.ncx</h4>
    <h4>au moins un fichier .xhtml</h4>
    <p>Exemple de note de bas de page<a epub:type="noteref" href="#note_ch2-1" id="ref_ch2-1"> [1]</a></p>

    <h2 id="ch2-02" epub:type="bodymatter subchapter">Créer le fichier final </h2>
    <p>Un EPUB est un ensemble de fichiers compressés. Pour que le résultat final ne comporte pas d’erreur il faut faire l’oppération en utilisant la commande suivante dans un terminal (sous linux pour les autres systèmes faut chercher) : <code>zip -rX nom_EPUB.epub mimetype META-INF OPS</code>.</p>
    <p><code>zip</code> permet de définir le format de compression, <code>-r</code> permet d’ajouter l’option récursive, ainsi les fichiers inclus dans les dossiers seront pris en compte. <code>X</code>??. Ensuite il faut donner le nom que l’on voudra donner au fichier compressé, penser à ne pas mettre d’espace ou de caractères spéciaux, et de mettre l’extension .epub. Ensuite on dit les fichiers/dossiers que l’on veut ajouter. </p>
    <h2 id="ch2-03" epub:type="bodymatter subchapter">Vérifier l’EPUB </h2>
    <p>Une fois l’EPUB créé avant même de regarder le résultat il vaut mieux vérifier s’il est valide. Lors de la construction de l’EPUB on peut vérifier que les fichiers .XHTML s’affichet bien dans un navigateur, on a ainsi une idée de la présentation mais surtout on a évité pas mal de petites erreurs dans le code. L’EPUB étant un ensemble de fichiers il faut vérifier que le code passera bien.</p>
    <p>L’IDPF a conçu un validateur que l’on peut utiliser soit en local (il faut l’installer sur son ordinateur) soit en ligne. La version en ligne est toujours à jour et ne demande pas l’installation, mais valider l’EPUB est relativement long (quelques secondes) et peut demander du temps de transfert suivant la taille de l’EPUB donc c’est selon les goûts de chacun. Comme souvent les messages d’erreurs sont pas très compréhensibles, il faut de l’habitude et ne pas hésiter à tester. Pour cette partie là un gestionnaire de version (comme git) peut être très utile. </p>
    <aside epub:type="footnotes">
    <ol class="references" epub:type="footnote">
      <li><a  epub:type="footnote" href="#ref_ch2-1" id="note_ch2-1">1.</a> Contenu de la note de bas de page. Pour indiquer la référence bien mettre une espace insécable avant les crochets entourant le numéro de la référence. Ça permet d'avoir une zone plus grande pour sélectionner le lien notamment sur liseuse où la sélection se fait avec un doigt. </li>
    </ol>
    </aside>
  </body>
</html>

